<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tienda Online - Grupos de Productos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a3a4d;
      color: white;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      color: #fcd000;
      text-align: center;
    }
    .grupos {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }
    .grupo {
      background: #0c1e2c;
      padding: 20px;
      border-radius: 10px;
      cursor: pointer;
      min-width: 150px;
      text-align: center;
      transition: background-color 0.3s;
      user-select: none;
    }
    .grupo:hover {
      background-color: #fcd000;
      color: #000;
      font-weight: bold;
    }
    .productos {
      max-width: 600px;
      margin: 0 auto 40px;
    }
    .producto {
      background: #0c1e2c;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    button {
      background-color: #fcd000;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #e0b800;
    }

    /* Icono carrito */
    #carrito-icono {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #0c1e2c;
      border: 2px solid #fcd000;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 999;
    }
    #carrito-icono:hover {
      background: #fcd000;
      color: #0c1e2c;
    }
    #carrito-icono span {
      position: absolute;
      top: -5px;
      right: -5px;
      background: red;
      color: white;
      font-size: 12px;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 50%;
    }

    /* Modal general */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: #0c1e2c;
      padding: 25px;
      border-radius: 10px;
      text-align: center;
      color: white;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 0 15px #fcd000;
      position: relative;
    }

    .modal-content input[type="number"],
    .modal-content input[type="text"],
    .modal-content input[type="email"],
    .modal-content textarea {
      width: 100%;
      font-size: 1rem;
      padding: 8px;
      border-radius: 5px;
      border: none;
      margin: 10px 0;
      box-sizing: border-box;
      resize: vertical;
    }

    .modal-content textarea {
      height: 80px;
    }

    .pedido-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
  </style>
</head>
<body>

  <h1>Elige un grupo de productos</h1>

  <!-- Icono carrito -->
  <div id="carrito-icono" onclick="abrirResumen()">
    ðŸ›’
    <span id="contador-carrito">0</span>
  </div>

  <div class="grupos" id="grupos-container"></div>
  <div class="productos" id="productos-container"></div>

  <!-- Modal cantidad -->
  <div class="modal" id="modal-cantidad">
    <div class="modal-content">
      <h3 id="modal-producto-nombre">Producto</h3>
      <label for="cantidad-input">Cantidad:</label><br/>
      <input type="number" id="cantidad-input" min="1" value="1" />
      <br/>
      <button id="agregar-carrito-btn">Agregar al carrito</button>
      <button onclick="cerrarModal()" style="margin-top:10px; background:#666; color:#fff;">Cancelar</button>
    </div>
  </div>

  <!-- Modal resumen de carrito -->
  <div class="modal" id="modal-resumen">
    <div class="modal-content">
      <h3>Resumen del Pedido</h3>
      <div id="lista-pedido"></div>

      <!-- Formulario para enviar pedido -->
      <form id="formulario-pedido">
        <input type="text" name="nombre" placeholder="Tu nombre" required />
        <input type="email" name="email" placeholder="Tu Numero de contacto" required />
        <textarea name="detalles" readonly></textarea>
        <button type="submit" style="background:#fcd000; color:#000; margin-top:10px;">Enviar Pedido</button>
      </form>

      <button onclick="cerrarResumen()" style="margin-top:10px;">Cerrar</button>
    </div>
  </div>

  <script>
    const tienda = {
      "Mosquiteros": ["Mosquitero sencillo", "Mosquitero doble", "Mosquitero magnÃ©tico"],
      "CosmÃ©ticos": ["Labial", "Crema facial", "Base de maquillaje"],
      "Extensiones para cabello": ["ExtensiÃ³n rizada", "ExtensiÃ³n lisa", "ExtensiÃ³n ondulada"],
      "Accesorios para bebÃ©s": ["Chupete", "BiberÃ³n", "Mordedera"],
      "Producto escolar": ["Cuadernos", "LÃ¡pices", "Mochila escolar"],
      "Mochilas": ["Mochila casual", "Mochila deportiva", "Mochila ejecutiva"],
      "Peluches": ["Osito", "Conejo", "Perro"],
      "MueblerÃ­a": ["Silla", "Mesa", "EstanterÃ­a"]
    };

    const gruposContainer = document.getElementById('grupos-container');
    const productosContainer = document.getElementById('productos-container');
    const modal = document.getElementById('modal-cantidad');
    const modalProductoNombre = document.getElementById('modal-producto-nombre');
    const cantidadInput = document.getElementById('cantidad-input');
    const agregarCarritoBtn = document.getElementById('agregar-carrito-btn');
    const contadorCarrito = document.getElementById('contador-carrito');
    const modalResumen = document.getElementById('modal-resumen');
    const listaPedido = document.getElementById('lista-pedido');
    const formularioPedido = document.getElementById('formulario-pedido');
    const textareaDetalles = formularioPedido.querySelector('textarea');

    let carrito = [];
    let productoActual = null;

    // Mostrar grupos
    Object.keys(tienda).forEach(grupo => {
      const div = document.createElement('div');
      div.className = 'grupo';
      div.textContent = grupo;
      div.addEventListener('click', () => mostrarProductos(grupo));
      gruposContainer.appendChild(div);
    });

    // Mostrar productos
    function mostrarProductos(grupo) {
      productosContainer.innerHTML = `<h2>${grupo}</h2>`;
      tienda[grupo].forEach(producto => {
        const prodDiv = document.createElement('div');
        prodDiv.className = 'producto';

        const nombre = document.createElement('span');
        nombre.textContent = producto;

        const btnPedir = document.createElement('button');
        btnPedir.textContent = 'Pedir';
        btnPedir.addEventListener('click', () => abrirModal(producto));

        prodDiv.appendChild(nombre);
        prodDiv.appendChild(btnPedir);
        productosContainer.appendChild(prodDiv);
      });
    }

    // Abrir modal cantidad
    function abrirModal(producto) {
      productoActual = producto;
      modalProductoNombre.textContent = producto;
      cantidadInput.value = 1;
      modal.classList.add('active');
      cantidadInput.focus();
    }

    // Cerrar modal cantidad
    function cerrarModal() {
      modal.classList.remove('active');
    }

    // Agregar producto al carrito
    agregarCarritoBtn.addEventListener('click', () => {
      const cantidad = parseInt(cantidadInput.value);
      if (cantidad < 1 || isNaN(cantidad)) {
        alert('Cantidad no vÃ¡lida.');
        return;
      }

      const existente = carrito.find(item => item.producto === productoActual);
      if (existente) {
        existente.cantidad += cantidad;
      } else {
        carrito.push({ producto: productoActual, cantidad });
      }

      cerrarModal();
      actualizarContador();
    });

    // Actualizar contador carrito
    function actualizarContador() {
      const total = carrito.reduce((sum, item) => sum + item.cantidad, 0);
      contadorCarrito.textContent = total;
    }

    // Abrir modal resumen carrito y llenar lista y detalles del pedido
    function abrirResumen() {
      listaPedido.innerHTML = '';
      if (carrito.length === 0) {
        listaPedido.innerHTML = '<p>Tu carrito estÃ¡ vacÃ­o.</p>';
        textareaDetalles.value = '';
      } else {
        carrito.forEach(item => {
          const div = document.createElement('div');
          div.className = 'pedido-item';
          div.innerHTML = `<span>${item.producto}</span><span>x${item.cantidad}</span>`;
          listaPedido.appendChild(div);
        });
        // Construir texto detalles
        const detalles = carrito.map(item => `${item.producto} x${item.cantidad}`).join('\n');
        textareaDetalles.value = detalles;
      }
      modalResumen.classList.add('active');
    }

    // Cerrar modal resumen
    function cerrarResumen() {
      modalResumen.classList.remove('active');
    }

    // Enviar formulario con fetch para evitar recarga y abrir correo
    formularioPedido.addEventListener('submit', (e) => {
      e.preventDefault();

      if(carrito.length === 0){
        alert("El carrito estÃ¡ vacÃ­o. Agrega productos antes de enviar.");
        return;
      }

      // Construir datos para enviar
      const formData = new FormData(formularioPedido);

      // AquÃ­ la URL de tu FormSubmit con tu correo
      const url = "https://formsubmit.co/ajax/yoselyn96vasquez@gmail.com";

      fetch(url, {
        method: "POST",
        body: formData,
        headers: { 'Accept': 'application/json' }
      })
      .then(response => {
        if (response.ok) {
          alert("Pedido enviado correctamente. Gracias por tu compra.");
          carrito = [];
          actualizarContador();
          cerrarResumen();
          productosContainer.innerHTML = '';
          gruposContainer.scrollIntoView({behavior: "smooth"});
          formularioPedido.reset();
        } else {
          return response.json().then(data => {
            throw new Error(data.message || "Error al enviar pedido");
          });
        }
      })
      .catch(error => {
        alert("Error al enviar el pedido: " + error.message);
      });
    });
  </script>
</body>
</html>
