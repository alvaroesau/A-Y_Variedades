<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tienda en Línea - MANOVOLT</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  /* Se omiten estilos por brevedad, siguen siendo los mismos */
</style>
</head>
<body>

<header>
  <div class="logo">⚡<span>MANOVOLT</span></div>
  <div class="menu-toggle" id="menu-toggle">
    <i class="fas fa-bars"></i>
  </div>
  <nav id="nav-links">
    <a href="#">Inicio</a>
    <a href="#">Categorías</a>
    <a href="#">Contacto</a>
  </nav>
</header>

<section class="products" id="products-list">
  <!-- Productos se cargarán aquí -->
</section>

<div id="cart-icon" title="Ver carrito">
  <i class="fas fa-shopping-cart"></i>
  <div id="cart-count">0</div>
</div>

<div class="modal" id="cart-modal">
  <div class="modal-content">
    <button class="close-btn" id="close-cart">&times;</button>
    <h3>Tu carrito de compras</h3>
    <div id="cart-items"></div>
    <form id="order-form" method="POST" action="https://formsubmit.co/ajax/yoselyn96vasquez@gmail.com">
      <label for="nombre">Nombre completo:</label>
      <input type="text" id="nombre" name="nombre" required />
      <label for="telefono">Número de teléfono:</label>
      <input type="tel" id="telefono" name="telefono" pattern="[0-9]{8}" placeholder="Ej: 74656746" required />
      <label for="correo">Correo electrónico:</label>
      <input type="email" id="correo" name="correo" required />
      <label for="pedido">Detalles del pedido:</label>
      <textarea id="pedido" name="pedido" rows="5" readonly required></textarea>
      <button type="submit">Enviar pedido</button>
    </form>
  </div>
</div>

<div class="modal" id="modal-confirm">
  <div class="modal-content">
    <h3>✅ Tu pedido ha sido enviado con éxito</h3>
    <p>Gracias por tu compra. Te contactaremos pronto.</p>
    <button onclick="location.reload()">OK</button>
  </div>
</div>

<script>
  const groupedProducts = {
    "Mosquiteros": ["Mosquitero Blanco", "Mosquitero Rosado"],
    "Cosméticos": ["Labial", "Base", "Sombras"],
    "Extensiones para cabello": ["Extensión Lisa", "Extensión Rizada"],
    "Accesorios para Babys": ["Chupón", "Juguete de goma"],
    "Producto escolar": ["Cuaderno", "Lápiz", "Colores"],
    "Mochilas": ["Mochila Escolar", "Mochila Deportiva"],
    "Peluches": ["Oso grande", "Conejo pequeño"],
    "Mueblería": ["Silla", "Mesa", "Estante"]
  };

  const productsList = document.getElementById('products-list');
  const cartIcon = document.getElementById('cart-icon');
  const cartCount = document.getElementById('cart-count');
  const cartModal = document.getElementById('cart-modal');
  const closeCartBtn = document.getElementById('close-cart');
  const cartItemsDiv = document.getElementById('cart-items');
  const orderForm = document.getElementById('order-form');
  const pedidoTextarea = document.getElementById('pedido');
  const modalConfirm = document.getElementById('modal-confirm');

  let cart = [];

  function loadProducts() {
    productsList.innerHTML = '';
    for (let category in groupedProducts) {
      const catTitle = document.createElement('h3');
      catTitle.textContent = category;
      catTitle.style.gridColumn = '1 / -1';
      productsList.appendChild(catTitle);

      groupedProducts[category].forEach(name => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <div>${name}</div>
          <input type="number" min="1" value="1" id="qty-${name}" style="width: 50px; margin-top:5px" />
          <button onclick="addToCart(\"${name}\")">Pedir</button>
        `;
        productsList.appendChild(div);
      });
    }
  }

  function addToCart(name) {
    const qtyInput = document.getElementById(`qty-${name}`);
    const quantity = parseInt(qtyInput.value);
    if (!quantity || quantity < 1) return;
    const existing = cart.find(item => item.name === name);
    if (existing) {
      existing.quantity += quantity;
    } else {
      cart.push({ name, quantity });
    }
    updateCartCount();
  }

  function updateCartCount() {
    const total = cart.reduce((acc, item) => acc + item.quantity, 0);
    cartCount.textContent = total;
  }

  cartIcon.addEventListener('click', () => {
    renderCartItems();
    updatePedidoTextarea();
    cartModal.style.display = 'flex';
  });

  closeCartBtn.addEventListener('click', () => {
    cartModal.style.display = 'none';
  });

  function renderCartItems() {
    if (cart.length === 0) {
      cartItemsDiv.innerHTML = '<p>El carrito está vacío.</p>';
      pedidoTextarea.value = '';
      return;
    }
    cartItemsDiv.innerHTML = '';
    cart.forEach(item => {
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <span>${item.name} x ${item.quantity}</span>
        <button onclick="removeFromCart(\"${item.name}\")">Eliminar</button>
      `;
      cartItemsDiv.appendChild(div);
    });
  }

  function removeFromCart(name) {
    cart = cart.filter(item => item.name !== name);
    renderCartItems();
    updateCartCount();
    updatePedidoTextarea();
  }

  function updatePedidoTextarea() {
    if (cart.length === 0) {
      pedidoTextarea.value = '';
      return;
    }
    let text = 'Pedido:\n';
    cart.forEach(item => {
      text += `- ${item.name}: ${item.quantity}\n`;
    });
    pedidoTextarea.value = text;
  }

  orderForm.addEventListener('submit', function(e){
    e.preventDefault();
    if(cart.length === 0){
      alert('Tu carrito está vacío. Agrega productos antes de enviar el pedido.');
      return;
    }
    const formData = new FormData(orderForm);
    fetch(orderForm.action, {
      method: 'POST',
      headers: { 'Accept': 'application/json' },
      body: formData
    })
    .then(response => {
      if(response.ok){
        cartModal.style.display = 'none';
        modalConfirm.style.display = 'flex';
        cart = [];
        updateCartCount();
        orderForm.reset();
      } else {
        alert('Error al enviar el pedido.');
      }
    })
    .catch(() => alert('Error al conectar con el servidor.'));
  });

  const toggle = document.getElementById('menu-toggle');
  const nav = document.getElementById('nav-links');
  toggle.addEventListener('click', () => {
    nav.classList.toggle('active');
  });

  const links = document.querySelectorAll('#nav-links a');
  links.forEach(link => {
    link.addEventListener('click', () => {
      nav.classList.remove('active');
    });
  });

  loadProducts();
</script>

</body>
</html>
